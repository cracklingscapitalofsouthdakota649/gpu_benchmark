[pytest]
# -------------------------------------------------------------------
# Pytest Configuration for GPU/CPU Benchmark & Allure Reporting (Linux CI)
# -------------------------------------------------------------------
pythonpath = .
minversion = 8.0
timeout_method = thread
timeout_func_only = true

testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

markers =
    gpu: GPU-related tests (generic CUDA/ROCm/Intel)
    cpu: CPU-bound tests
    nvidia: NVIDIA-specific tests
    amd: AMD-specific tests
    intel: Intel-specific tests
    directml: DirectML-specific tests
    benchmark: Performance benchmarking
    stress: Heavy-load or endurance tests
    preprocess: Data preprocessing
    accelerator: GPU accelerator tasks
    io_accelerator: I/O accelerator performance tests
    network_io_accelerator: Network I/O accelerator performance tests

addopts =
    --tb=short
    --alluredir=allure-results
    --disable-warnings
    -v
    -ra -q
    --maxfail=3
    --durations=10

filterwarnings =
    ignore::DeprecationWarning
    ignore::UserWarning
    ignore::RuntimeWarning
    ignore::FutureWarning

env =
    PYTHONUNBUFFERED=1
    PYTEST_DISABLE_PLUGIN_AUTOLOAD=1
    MPLCONFIGDIR=/tmp/matplotlib-cache
    NUMEXPR_MAX_THREADS=8
    OMP_NUM_THREADS=8
    CUDA_VISIBLE_DEVICES=0

# Overall timeout for the entire test function (set by pytest-timeout)
# Kill a test if it runs longer than 10 minutes (600s)
timeout = 600
# Print tracebacks if a test runs longer than 5 minutes (300s)
faulthandler_timeout = 300

asyncio_mode = auto
norecursedirs = .* build dist venv .venv .cache

# -------------------------------------------------------------------
# Pytest-Benchmark Configuration (REQUIRED FOR MAX_TIME FIX)
# -------------------------------------------------------------------
[pytest-benchmark]
# FIX: Increased max_time significantly to prevent timeouts on heavy CPU tests (4096x4096 matrix).
max_time = 60.0
# Sets the minimum number of rounds to run (moved from addopts).
min_rounds = 5
# Save benchmark results to a JSON file for Allure (moved from addopts).
json = allure-results/benchmark.json
# Save the result to a dedicated 'latest' folder for trend tracking (moved from addopts).
save = latest
# Autosave on teardown (moved from addopts).
autosave = true
